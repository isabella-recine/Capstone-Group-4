create or replace view CAPSTONE_DE.GROUP_4.ACCIDENT_RANKED_VW(
	BOROUGH,
	ACCIDENT_TYPE,
	TOTAL_ACCIDENTS,
	RANK
) as (
    WITH ranked_accident AS(
        SELECT BOROUGH, 
               CONTRIBUTING_FACTOR_VEHICLE_1 ACCIDENT_TYPE, 
               COUNT(*) TOTAL_ACCIDENTS,
               RANK() OVER (PARTITION BY BOROUGH ORDER BY TOTAL_ACCIDENTS DESC) AS RANK
        FROM CAPSTONE_DE.GROUP_4.ACCIDENT_DATA
        GROUP BY BOROUGH, CONTRIBUTING_FACTOR_VEHICLE_1
    )
    SELECT BOROUGH,
           ACCIDENT_TYPE, 
           TOTAL_ACCIDENTS,
           RANK
    FROM ranked_accident
    WHERE rank <= 5
);
